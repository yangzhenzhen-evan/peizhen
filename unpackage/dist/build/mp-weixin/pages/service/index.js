"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("navbar")+e.resolveComponent("uni-steps")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-card")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-popup-dialog"))()}Math||((()=>"../../components/navbar/navbar.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-steps/uni-steps.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-list-item/uni-list-item.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-list/uni-list.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-card/uni-card.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup-dialog/uni-popup-dialog.js"))();const o={__name:"index",setup(o){const t=getApp(),a=e.ref([]),l=e.ref(0);a.value=[{title:"填写订单"},{title:"在线支付"},{title:"专人服务"},{title:"服务完成"}];const i=e.ref({}),n=e.ref(),s=e.reactive({tel:"",code:"",codetext:"点击获取验证码",time:60}),r=e.ref(),d=e.reactive({price:"0",address:{cityName:"",countyName:"",detailInfo:"",userName:""},demand:"",hospital_id:0,hospital_name:"",receiveAddress:"",service_code:"",service_id:0,service_name:"",service_stype:"",starttime:0,tel:"",client:{age:0,mobile:"",name:"",sex:0}}),u=e.ref({}),c=e.ref(0);let m=e.computed({get(){const o=e.toRaw(u.value).map(((e,o)=>e.name));return console.log("re33",o),o}});const p=o=>{c.value=o.detail.value;const t=e.toRaw(u.value);d.price=t[c.value].service_price,d.hospital_id=t[c.value].id,d.hospital_name=t[c.value].name,console.log("serform",d)},v=e.computed({get(){const e=t.globalData.common.toDate(d.starttime);return console.log("serform.starttime",d.starttime),e}});e.ref(1);let g=e.computed({get:()=>d.address.userName?`${d.address.userName}(${d.address.cityName}-${d.address.countyName}-${d.address.detailInfo}`:"请输入收件信息"});const f=()=>{console.log(123),e.index.chooseAddress({success:e=>{let{cityName:o,countyName:t,detailInfo:a,userName:l}=e;d.address.cityName=o,d.address.countyName=t,d.address.detailInfo=a,d.address.userName=l,console.log("信息",d.address)}})},y=e.ref(!1),b=e.computed({get:()=>d.client.name?`${d.client.name}`:"请选择就诊人"}),h=()=>{e.index.navigateTo({url:"../client/client?act=select"})},x=()=>{n.value.close()},_=()=>{r.value.close(),e.index.switchTab({url:"../order/order"})},C=async()=>{if(!t.globalData.common.validateForm(!y.value,"请先勾选协议！"))return;if(!t.globalData.common.validateForm(0==c.value,"请先选择医院！"))return;if(!t.globalData.common.validateForm(0==d.starttime,"请先选择日期！"))return;if(40==i.value.stype&&!t.globalData.common.validateForm(!d.address.userName,"请先选择收件地址！"))return;if(15==i.value.stype&&!t.globalData.common.validateForm(!d.client.name,"请先选择就诊人！"))return;if(15==i.value.stype&&!t.globalData.common.validateForm(!d.receiveAddress,"请先填写收件信息！"))return;if(!t.globalData.common.validateForm(!d.tel,"请先填写电话！",d.tel))return;if(!e.index.getStorageSync("token"))return void n.value.open("center");const o=e.toRaw(d);try{const a=await t.globalData.apis.createOrder(o,e.index.getStorageSync("token"));console.log("创建订单",a),r.value.open("center");const l=new e.UQRCode;l.data=a.wx_code,l.size=150,l.make();const i=e.index.createCanvasContext("qrcode");l.canvasContext=i,l.drawCanvas()}catch(a){e.index.showToast({title:a,icon:"none"})}};let w=!1;const D=async()=>{if(!t.globalData.common.validateForm(!s.tel,"请先填写电话！",s.tel))return;if(w)return;console.log("flag");let o=setInterval((()=>{s.time<=0?(w=!1,s.time=60,s.codetext="重新获取验证码",clearInterval(o)):(w=!0,s.time-=1,s.codetext=`剩余${s.time}s`)}),1e3);try{await t.globalData.apis.sendCode(s.tel)}catch(a){e.index.showToast({title:"发送过于频繁，请1小时后再试！",icon:"none"}),w=!1,s.time=60,s.codetext="点击获取验证码",clearInterval(o)}},k=async()=>{if(!s.tel||!s.code)return e.index.showToast({title:"请填写手机号或验证码！",icon:"none"});const o=await t.globalData.apis.checkCode(s.tel,s.code);e.index.setStorageSync("token",o.data.token),n.value.close()};e.onLoad((async o=>{console.log("obj",o);const a=await t.globalData.apis.serviceData(o.svid);i.value=a.data.service,u.value=a.data.hospitals,console.log("ser",i),console.log("hos",u);const l=e.toRaw(i.value);if(d.service_code=l.code,d.service_id=l.id,d.service_name=l.name,d.service_stype=l.stype,o.hid>0){const t=e.toRaw(u.value);for(let e=0;e++;e<t.length)o.hid==t[e].id&&(c.value=e,d.price=t[e].service_price,d.hospital_id=t[e].id,d.hospital_name=t[e].name)}console.log("serform",d),e.index.$on("showClient",(e=>{console.log("就诊信息",e);const{name:o,age:t,mobile:a,sex:l,user_id:i}=e;d.client.age=t,d.client.mobile=a,d.client.name=o,d.client.sex=l,console.log(d.client)}))})),e.onUnload((()=>{e.index.$off("showClient")}));const j=()=>{};return(o,t)=>e.e({a:e.p({title:"填写服务订单"}),b:e.p({options:a.value,active:l.value,"active-color":"white"}),c:e.t(i.value.name),d:e.p({type:"info",size:"20",color:"#d2d2d2"}),e:e.o(j),f:e.p({thumb:i.value.icon_image_url,"thumb-size":"lg"}),g:40==i.value.stype||15==i.value.stype},40==i.value.stype||15==i.value.stype?e.e({h:e.t(e.unref(m)[c.value]),i:e.o(p),j:c.value,k:e.unref(m),l:e.p({type:"right",size:"18"}),m:e.p({label:"选择医院"}),n:0==d.starttime},0==d.starttime?{}:{o:e.t(v.value)},{p:e.o((e=>d.starttime=e)),q:e.p({returnType:"timestamp",modelValue:d.starttime}),r:e.p({type:"right",size:"18"}),s:e.p({label:"选择日期"}),t:40==i.value.stype},40==i.value.stype?{v:e.t(e.unref(g)),w:e.p({type:"right",size:"18"}),x:e.o(f),y:e.p({label:"收件信息"})}:{},{z:15==i.value.stype},15==i.value.stype?{A:e.t(b.value),B:e.p({type:"right",size:"18"}),C:e.o(h),D:e.p({label:"就诊人"})}:{},{E:15==i.value.stype},15==i.value.stype?{F:e.o((e=>d.receiveAddress=e)),G:e.p({placeholder:"请输入接送地址",inputBorder:!1,clearable:!1,modelValue:d.receiveAddress}),H:e.p({type:"right",size:"18"}),I:e.p({label:"接送地址"})}:{},{J:e.o((e=>d.tel=e)),K:e.p({type:"number",placeholder:"请输入联系电话",inputBorder:!1,clearable:!1,modelValue:d.tel}),L:e.p({type:"right",size:"18"}),M:e.p({label:"联系电话"}),N:e.sr("serForm","2274edd2-7,2274edd2-6"),O:e.p({modelValue:d,rules:o.rules})}):{},{P:40==i.value.stype||15==i.value.stype},40==i.value.stype||15==i.value.stype?{Q:d.demand,R:e.o((e=>d.demand=e.detail.value))}:{},{S:y.value,T:e.o((e=>y.value=!y.value)),U:e.t(d.price),V:e.o(C),W:e.s(y.value?"color:#ffffff;background-color:#1AAD19;border-color:#1AAD19;":""),X:e.o((e=>s.tel=e)),Y:e.p({type:"number",placeholder:"请输入联系电话",clearable:!1,modelValue:s.tel}),Z:e.o((e=>s.code=e)),aa:e.p({type:"text",placeholder:"请输入验证码",clearable:!1,modelValue:s.code}),ab:e.t(s.codetext),ac:e.o(D),ad:e.sr(s,"2274edd2-25,2274edd2-24",{k:"loginForm"}),ae:e.p({modelValue:s,rules:o.rules}),af:e.o(x),ag:e.o(k),ah:e.sr(n,"2274edd2-24",{k:"loginDialog"}),ai:e.p({type:"center","is-mask-click":!1,"background-color":"#fff"}),aj:e.o(_),ak:e.p({type:"info",confirmText:"关闭",title:"支付二维码",content:"欢迎使用 uni-popup!",showClose:!1}),al:e.sr(r,"2274edd2-30",{k:"payDialog"}),am:e.p({type:"dialog"})})}},t=e._export_sfc(o,[["__scopeId","data-v-2274edd2"]]);wx.createPage(t);
